# è—å®é˜ä¸»é¢˜æ•°æ®è¿ç§»æŒ‡å—

## ğŸ“‹ èƒŒæ™¯

æ—§ç‰ˆè—å®é˜å°†ä¸»é¢˜ï¼ˆLife/Knowledge/Thought/Rootï¼‰å­˜å‚¨åœ¨ `tags` å­—æ®µä¸­ã€‚
æ–°ç‰ˆå°†ä¸»é¢˜ç‹¬ç«‹åˆ° `theme` å­—æ®µï¼Œéœ€è¦è¿ç§»æ—§æ•°æ®ã€‚

## ğŸ¯ è¿ç§»ç›®æ ‡

**è¿ç§»å‰**ï¼š
```json
{
  "theme": [],
  "tags": ["Life", "Knowledge", "#é¢†åŸŸ/ç¼–ç¨‹", "#æ¦‚å¿µ/æ¶æ„"]
}
```

**è¿ç§»å**ï¼š
```json
{
  "theme": ["life", "knowledge"],
  "tags": ["#é¢†åŸŸ/ç¼–ç¨‹", "#æ¦‚å¿µ/æ¶æ„"]
}
```

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### 1. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
cd project-nexus
pnpm install tsx
```

### 2. è¿è¡Œè¿ç§»è„šæœ¬
```bash
pnpm tsx scripts/migrate-treasure-themes.ts
```

### 3. æŸ¥çœ‹è¾“å‡º
è„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- æ‰¾åˆ°å¤šå°‘ä¸ªéœ€è¦è¿ç§»çš„å®è—
- æ¯ä¸ªå®è—çš„è¿ç§»è¯¦æƒ…
- æœ€ç»ˆç»Ÿè®¡ï¼ˆæˆåŠŸ/è·³è¿‡ï¼‰

## ğŸ“Š ç¤ºä¾‹è¾“å‡º

```
ğŸš€ å¼€å§‹è¿ç§»å®è—ä¸»é¢˜æ•°æ®...

ğŸ“Š æ‰¾åˆ° 42 ä¸ªéœ€è¦è¿ç§»çš„å®è—

âœ… [abc123] "æˆ‘çš„ç¬¬ä¸€ä¸ªå®è—"
   ä¸»é¢˜: life, knowledge
   æ ‡ç­¾: #é¢†åŸŸ/ç¼–ç¨‹, #æ¦‚å¿µ/æ¶æ„, #æŠ€æœ¯/React

âœ… [def456] "å­¦ä¹ ç¬”è®°"
   ä¸»é¢˜: knowledge
   æ ‡ç­¾: #æ¦‚å¿µ/è®¾è®¡æ¨¡å¼

...

ğŸ“ˆ è¿ç§»ç»Ÿè®¡ï¼š
   âœ… æˆåŠŸè¿ç§»: 38 ä¸ª
   â­ï¸  è·³è¿‡: 4 ä¸ªï¼ˆæ— ä¸»é¢˜æ ‡ç­¾ï¼‰

ğŸ‰ è¿ç§»å®Œæˆï¼
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®åº“**ï¼ˆæ¨èï¼‰
   ```bash
   # å¦‚æœä½¿ç”¨ Neonï¼Œå¯ä»¥åˆ›å»ºå¿«ç…§
   # æˆ–å¯¼å‡ºæ•°æ®
   pg_dump $DATABASE_URL > backup.sql
   ```

2. **å¹‚ç­‰æ€§**
   - è„šæœ¬å¯ä»¥å®‰å…¨åœ°å¤šæ¬¡è¿è¡Œ
   - åªä¼šè¿ç§» `theme` ä¸ºç©ºçš„å®è—

3. **ä¸å½±å“æ–°æ•°æ®**
   - å·²æœ‰ `theme` çš„å®è—ä¸ä¼šè¢«ä¿®æ”¹

## ğŸ” éªŒè¯è¿ç§»

### æ–¹æ³• 1ï¼šæŸ¥çœ‹æ•°æ®åº“
```sql
-- æ£€æŸ¥è¿ç§»åçš„æ•°æ®
SELECT 
  id, 
  title, 
  theme, 
  tags 
FROM treasures 
WHERE array_length(theme, 1) > 0 
LIMIT 10;
```

### æ–¹æ³• 2ï¼šåœ¨å‰ç«¯æŸ¥çœ‹
1. æ‰“å¼€è—å®é˜
2. ç‚¹å‡»ä¸»é¢˜ç­›é€‰æŒ‰é’®ï¼ˆğŸŒ± ç”Ÿæ´» ç­‰ï¼‰
3. ç¡®è®¤ç­›é€‰æ­£å¸¸å·¥ä½œ

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ° tsx
```bash
# å…¨å±€å®‰è£…
pnpm add -g tsx

# æˆ–ä½¿ç”¨ npx
npx tsx scripts/migrate-treasure-themes.ts
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ `.env` ä¸­çš„ `DATABASE_URL`
- ç¡®è®¤æ•°æ®åº“å¯è®¿é—®

### é—®é¢˜ 3ï¼šæƒé™é”™è¯¯
- ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æœ‰ UPDATE æƒé™

## ğŸ“ å›æ»šï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœè¿ç§»å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨å›æ»šï¼š

```sql
-- å°† theme ç§»å› tagsï¼ˆä»…ç¤ºä¾‹ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
UPDATE treasures
SET 
  tags = array_cat(
    ARRAY(SELECT unnest(theme)),
    tags
  ),
  theme = ARRAY[]::text[]
WHERE array_length(theme, 1) > 0;
```

## âœ… è¿ç§»åæ¸…ç†

è¿ç§»æˆåŠŸåï¼Œå¯ä»¥åˆ é™¤è¿ç§»è„šæœ¬ï¼ˆå¯é€‰ï¼‰ï¼š
```bash
rm scripts/migrate-treasure-themes.ts
```

---

**åˆ›å»ºæ—¶é—´**: 2026-01-08  
**ç»´æŠ¤è€…**: Antigravity
