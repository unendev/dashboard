# 需求文档：Timer标签识别与AI解析功能

## 介绍

Timer小部件目前存在标签处理的问题：
1. **AI创建框**：输入"#个人网站"时，系统应该识别为标签，但目前被当作任务名处理
2. **传统表单框**：选择标签后，系统没有真正调用事务项逻辑打上标签，而是把标签作为任务名
3. **不一致性**：Timer和Nexus的创建逻辑不同，应该统一

本功能的目标是：
1. 修复AI创建框的标签识别逻辑，确保"#个人网站"被识别为标签而非任务名
2. 修复传统表单框的标签应用逻辑，确保选择的标签真正被打上
3. 统一Timer和Nexus的创建逻辑（共用后端API或相同的处理规则）

## 术语表

- **事务项标签（Instance Tag）**：应用于任务的元数据标签，如"项目Nexus"、"个人网站"
- **任务名称**：任务的主要标识符，如"写代码"、"蓄能"
- **分类路径**：任务的分层分类，如"工作/开发"、"自我复利/身体蓄能"
- **标签字符串**：逗号分隔的标签列表，如"项目Nexus,前端"
- **AI解析**：使用AI模型（DeepSeek）自动提取任务组件
- **Timer小部件**：基于Electron的桌面计时应用
- **Nexus系统**：基于Web的任务管理系统

## 需求

### 需求1：AI创建框的标签识别

**用户故事**：作为Timer用户，我想在AI创建框中输入"#个人网站"时，系统能识别为标签并真正打上标签，而不是把它作为任务名，这样我可以快速创建带标签的任务。

#### 验收标准

1. 当用户在AI创建框输入"#个人网站"时，系统应该调用AI解析器提取标签，返回的instanceTags数组应包含"个人网站"
2. 当AI解析器返回instanceTags时，系统应该将这些标签真正应用到任务上（通过instanceTagNames字段传递）
3. 当用户输入"写代码 #项目Nexus #前端"时，系统应该提取任务名"写代码"和标签["项目Nexus", "前端"]
4. 当用户只输入"#个人网站"时，系统应该使用分类名作为任务名，并将"个人网站"作为标签

### 需求2：传统表单框的标签应用逻辑修复

**用户故事**：作为Timer用户，我想在传统表单框中选择标签后，系统能真正调用事务项逻辑打上标签，而不是把标签作为任务名，这样我的标签选择才有意义。

#### 验收标准

1. 当用户在表单框中选择标签（如"个人网站"）时，系统应该将其添加到selectedTags数组中
2. 当用户提交表单时，系统应该将selectedTags转换为逗号分隔的字符串（如"个人网站,项目Nexus"）并通过instanceTagNames字段传递
3. 当用户在任务名字段输入"#个人网站"时，系统应该自动提取标签并添加到selectedTags中
4. 当用户同时手动选择标签和在任务名中输入#标签时，系统应该合并两个来源的标签

### 需求3：Timer和Nexus创建逻辑的一致性

**用户故事**：作为系统管理员，我想Timer和Nexus的创建框使用相同的后端API或处理规则，这样用户在两个系统中有统一的体验。

#### 验收标准

1. 当用户在Timer的AI创建框输入文本时，系统应该调用与Nexus相同的AI解析API（/api/timer-tasks/parse）
2. 当AI解析器返回结果时，格式应该相同：{ name, categoryPath, instanceTags }
3. 当Timer创建任务时，instanceTagNames字段的格式应该与Nexus相同（逗号分隔的字符串）
4. 当标签被应用到任务时，两个系统应该使用相同的数据结构和验证规则
5. 当用户在Timer表单模式中选择标签时，这些标签应该被正确传递到后端，而不是被当作任务名

### 需求4：AI解析器的标签提取规则

**用户故事**：作为开发者，我想AI解析器能正确识别和提取#开头的标签，这样用户输入"#个人网站"时能被正确识别为标签而非任务名。

#### 验收标准

1. 当AI解析器接收到包含#符号的输入时，应该将#后面的词识别为instanceTags
2. 当输入为"#个人网站"时，AI解析器应该返回instanceTags: ["个人网站"]，而不是name: "#个人网站"
3. 当输入为"写代码 #项目Nexus"时，应该返回name: "写代码"，instanceTags: ["项目Nexus"]
4. 当输入中有多个#标签时，应该全部提取到instanceTags数组中

