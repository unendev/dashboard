# 实现计划：Timer标签识别与AI解析功能

## 任务列表

- [x] 1. 改进AI解析器提示词





  - 修改`project-nexus/app/api/timer-tasks/parse/route.ts`中的提示词
  - 添加明确的规则：当输入仅包含标签时，使用分类名作为任务名
  - 添加更多示例，展示仅标签输入的处理方式
  - 强调instanceTags中的标签不应该包含#符号
  - _需求: 1.1, 4.1, 4.2, 4.3, 4.4_

- [x] 1.1 为AI解析器提示词编写属性测试

  - **属性1：AI解析器标签提取**
  - **验证需求 1.1, 4.1, 4.4**
  - **属性3：标签不作为任务名**
  - **验证需求 1.4, 4.2**

- [x] 2. 修复Timer表单模式的标签处理逻辑





  - 修改`timer/src/components/features/log/CreateLogFormWithCards.tsx`中的`handleSubmit()`
  - 移除使用`selectedTags[0]`作为任务名的逻辑
  - 当任务名为空时，使用分类名作为任务名
  - 确保标签始终通过`instanceTagNames`参数传递
  - _需求: 2.1, 2.2, 3.5_

- [x] 2.1 为表单标签处理编写属性测试


  - **属性5：表单标签选择**
  - **验证需求 2.1, 2.2**
  - **属性6：表单模式不使用标签作为任务名**
  - **验证需求 2.2**

- [x] 3. 改进Timer表单模式的UI反馈




  - 修改`timer/src/components/features/log/CreateLogFormWithCards.tsx`
  - 在表单中添加已选择标签的显示区域
  - 显示标签列表，让用户清楚地看到已选择的标签
  - 添加更清晰的提示文本
  - _需求: 2.1, 2.2_

- [x] 3.1 为标签转换编写属性测试

  - **属性4：标签转换为逗号分隔字符串**
  - **验证需求 1.2, 2.2, 3.3**

- [x] 4. 验证AI模式的标签处理





  - 检查`timer/src/components/features/log/CreateLogFormWithCards.tsx`中的`handleAiSubmit()`
  - 验证AI解析器返回的instanceTags是否被正确转换为逗号分隔字符串
  - 验证在Electron模式和Web模式下的行为一致
  - _需求: 1.1, 1.2, 3.1, 3.2_

- [x] 4.1 为AI模式编写属性测试


  - **属性7：API调用一致性**
  - **验证需求 3.1, 3.2**

- [x] 5. 集成测试：验证完整的标签处理流程




  - 测试AI模式：输入"#个人网站" → 验证任务包含正确的标签
  - 测试AI模式：输入"写代码 #项目Nexus" → 验证任务名和标签都正确
  - 测试表单模式：选择标签但不输入任务名 → 验证使用分类名作为任务名
  - 测试表单模式：输入任务名和选择标签 → 验证两者都被正确应用
  - _需求: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 3.5_

- [x] 6. 最终检查：确保所有测试通过


  - 运行所有单元测试
  - 运行所有属性基础测试
  - 运行集成测试
  - 验证没有回归问题

