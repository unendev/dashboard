# Requirements Document - Treasure Pavilion Enhancements

## Introduction

This document specifies enhancements to the Treasure Pavilion feature in Project Nexus. The Treasure Pavilion is a multi-modal content management system for storing and organizing personal treasures (text cards, images, music). This spec addresses two key improvements:

1. **Image Fullscreen Display** - Fix the image viewer to properly maximize and display images in fullscreen mode instead of being constrained within the card
2. **AI-Assisted Tag System** - Implement a new tag system with AI assistance for generating objective entity tags and suggesting domain/concept tags through an interactive sidebar

## Glossary

- **Treasure Pavilion**: Multi-modal content management system for storing text cards, images, and music
- **Image Lightbox**: Fullscreen image viewer modal for displaying images
- **Entity Tags** (`#实体/...`): Objective, factual tags automatically generated by AI (e.g., `#实体/技术/React`, `#实体/游戏/WarThunder`)
- **Domain Tags** (`#领域/...`): Domain/field categorization tags suggested by AI but selected by humans (e.g., `#领域/游戏`, `#领域/技术`)
- **Concept Tags** (`#概念/...`): Concept/theme tags suggested by AI but selected by humans (e.g., `#概念/创意`, `#概念/优化`)
- **Legacy Tags**: Existing tags from `treasure-tags.json` (preserved for backward compatibility, used only in mindmap view)
- **AI Sidebar**: Interactive panel for AI-assisted tag suggestion with lightweight chat functionality
- **Treasure Card**: Individual content item (text, image, or music) with metadata

## Requirements

### Requirement 1: Image Fullscreen Display Fix

**User Story:** As a user, I want to view images in proper fullscreen mode when I click on them in the Treasure Pavilion, so that I can see the full details without being constrained by the card layout.

#### Acceptance Criteria

1. WHEN a user clicks on an image in the treasure card THEN the system SHALL display the image in a fullscreen lightbox modal that covers the entire viewport
2. WHEN the lightbox is displayed THEN the system SHALL ensure the image is properly maximized and centered within the available space
3. WHEN the lightbox is open THEN the system SHALL prevent scrolling of the background content
4. WHEN a user clicks the close button or presses Escape THEN the system SHALL close the lightbox and return focus to the original card
5. WHEN multiple images exist THEN the system SHALL provide navigation controls (previous/next buttons) to browse through images
6. WHEN the lightbox is displayed on mobile devices THEN the system SHALL optimize the layout for smaller screens while maintaining image visibility

### Requirement 2: AI-Assisted Tag System with Interactive Chat Sidebar

**User Story:** As a user, I want to have a conversation with AI about my treasure content to get suggestions for domain and concept tags, so that I can efficiently and accurately tag treasures with both objective properties and subjective categorizations.

#### Acceptance Criteria

1. WHEN a user creates a treasure with content THEN the system SHALL provide an "Enable AI Assistance" button in the creation form
2. WHEN a user clicks "Enable AI Assistance" THEN the system SHALL display an AI sidebar panel on the right side of the form with a chat interface
3. WHEN the AI sidebar is displayed THEN the system SHALL automatically analyze the treasure content (title, content, and existing selected tags) and provide initial tag suggestions in the chat
4. WHEN a user types a message in the AI sidebar chat THEN the system SHALL send the message to AI for analysis and provide updated tag suggestions based on the conversation context
5. WHEN a user copies a suggested tag from the chat THEN the user can manually paste it into the tag input field to add it to the treasure
6. WHEN the user creates the treasure THEN the system SHALL generate objective entity tags (#实体/) using AI analysis and include them in the treasure record
7. WHEN AI tag generation or suggestion fails THEN the system SHALL gracefully handle the error and allow the user to continue without AI assistance
8. WHEN the AI sidebar is displayed on mobile devices THEN the system SHALL adapt the layout to maintain usability (collapsible panel or below the form)

